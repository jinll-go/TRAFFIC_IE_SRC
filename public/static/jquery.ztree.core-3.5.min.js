(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",CLICK_ICON:"ztree_icon_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false,enableMultiIcon:false},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onIConClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(e){var t=data.getRoot(e);if(!t){t={};data.setRoot(e,t)}t[e.data.key.children]=[];t.expandTriggerFlag=false;t.curSelectedList=[];t.noSelection=true;t.createdNodes=[];t.zId=0;t._ver=(new Date).getTime()},_initCache=function(e){var t=data.getCache(e);if(!t){t={};data.setCache(e,t)}t.nodes=[];t.doms=[]},_bindEvent=function(r){var e=r.treeObj,t=consts.event;e.bind(t.NODECREATED,function(e,t,n){tools.apply(r.callback.onNodeCreated,[e,t,n])});e.bind(t.CLICK,function(e,t,n,a,o){tools.apply(r.callback.onClick,[t,n,a,o])});e.bind(t.EXPAND,function(e,t,n){tools.apply(r.callback.onExpand,[e,t,n])});e.bind(t.COLLAPSE,function(e,t,n){tools.apply(r.callback.onCollapse,[e,t,n])});e.bind(t.ASYNC_SUCCESS,function(e,t,n,a){tools.apply(r.callback.onAsyncSuccess,[e,t,n,a])});e.bind(t.ASYNC_ERROR,function(e,t,n,a,o,i){tools.apply(r.callback.onAsyncError,[e,t,n,a,o,i])});e.bind(t.CLICK_ICON,function(e,t,n){tools.apply(r.callback.onIConClick,[e,t,n])})},_unbindEvent=function(e){var t=e.treeObj,n=consts.event;t.unbind(n.NODECREATED).unbind(n.CLICK).unbind(n.EXPAND).unbind(n.COLLAPSE).unbind(n.ASYNC_SUCCESS).unbind(n.ASYNC_ERROR).unbind(n.REMOVE)},_eventProxy=function(e){var t=e.target,n=data.getSetting(e.data.treeId),a="",o=null,i="",r="",s=null,l=null,d=null;if(tools.eqs(e.type,"mousedown")){r="mousedown"}else if(tools.eqs(e.type,"mouseup")){r="mouseup"}else if(tools.eqs(e.type,"contextmenu")){r="contextmenu"}else if(tools.eqs(e.type,"click")){var c=t.getAttribute("className")||t.getAttribute("class");if(tools.eqs(t.tagName,"span")&&t.getAttribute("treeNode"+consts.id.SWITCH)!==null){a=tools.getNodeMainDom(t).id;i="switchNode"}else{d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id;i="clickNode"}if(a){o=data.getNodeCache(n,a)}if(c&&(c.indexOf("ico")!=-1||c.indexOf("ico")!=-1)){var u=[];u.push(o);var f=c.split("_");if(f[1]=="device"){u.push(f[2])}else if(f[1]=="ch"){if(f[2]=="stream"){u.push(f[3])}else if(f[2]=="record"){u.push(f[2])}}if(n.callback.onIConClick){i="";s=null;r="";l=null;tools.apply(n.callback.onIConClick,u)}}}}else if(tools.eqs(e.type,"dblclick")){r="dblclick";d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id;i="switchNode"}}if(r.length>0&&a.length==0){d=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){a=tools.getNodeMainDom(d).id}}if(a.length>0){o=data.getNodeCache(n,a);switch(i){case"switchNode":if(!o.isParent){i=""}else if(tools.eqs(e.type,"click")||tools.eqs(e.type,"dblclick")&&tools.apply(n.view.dblClickExpand,[n.treeId,o],n.view.dblClickExpand)){s=handler.onSwitchNode}else{i=""}break;case"clickNode":s=handler.onClickNode;break}}switch(r){case"mousedown":l=handler.onZTreeMousedown;break;case"mouseup":l=handler.onZTreeMouseup;break;case"dblclick":l=handler.onZTreeDblclick;break;case"contextmenu":l=handler.onZTreeContextmenu;break}var p={stop:false,node:o,nodeEventType:i,nodeEventCallback:s,treeEventType:r,treeEventCallback:l};return p},_initNode=function(e,t,n,a,o,i,r){if(!n)return;var s=data.getRoot(e),l=e.data.key.children;n.level=t;n.tId=e.treeId+"_"+ ++s.zId;n.parentTId=a?a.tId:null;n.open=typeof n.open=="string"?tools.eqs(n.open,"true"):!!n.open;if(n[l]&&n[l].length>0){n.isParent=true;n.zAsync=true}else{n.isParent=typeof n.isParent=="string"?tools.eqs(n.isParent,"true"):!!n.isParent;n.open=n.isParent&&!e.async.enable?n.open:false;n.zAsync=!n.isParent}n.isFirstNode=o;n.isLastNode=i;n.getParentNode=function(){return data.getNodeCache(e,n.parentTId)};n.getPreNode=function(){return data.getPreNode(e,n)};n.getNextNode=function(){return data.getNextNode(e,n)};n.isAjaxing=false;data.fixPIdKeyValue(e,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(e,t){data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},addAfterA:function(e){_init.afterA.push(e)},addBeforeA:function(e){_init.beforeA.push(e)},addInnerAfterA:function(e){_init.innerAfterA.push(e)},addInnerBeforeA:function(e){_init.innerBeforeA.push(e)},addInitBind:function(e){_init.bind.push(e)},addInitUnBind:function(e){_init.unbind.push(e)},addInitCache:function(e){_init.caches.push(e)},addInitNode:function(e){_init.nodes.push(e)},addInitProxy:function(e,t){if(!!t){_init.proxys.splice(0,0,e)}else{_init.proxys.push(e)}},addInitRoot:function(e){_init.roots.push(e)},addNodesData:function(e,t,n){var a=e.data.key.children;if(!t[a])t[a]=[];if(t[a].length>0){t[a][t[a].length-1].isLastNode=false;view.setNodeLineIcos(e,t[a][t[a].length-1])}t.isParent=true;t[a]=t[a].concat(n)},addSelectedNode:function(e,t){var n=data.getRoot(e);if(!data.isSelectedNode(e,t)){n.curSelectedList.push(t)}},addCreatedNode:function(e,t){if(!!e.callback.onNodeCreated||!!e.view.addDiyDom){var n=data.getRoot(e);n.createdNodes.push(t)}},addZTreeTools:function(e){_init.zTreeTools.push(e)},exSetting:function(e){$.extend(true,_setting,e)},fixPIdKeyValue:function(e,t){if(e.data.simpleData.enable){t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId}},getAfterA:function(e,t,n){for(var a=0,o=_init.afterA.length;a<o;a++){_init.afterA[a].apply(this,arguments)}},getBeforeA:function(e,t,n){for(var a=0,o=_init.beforeA.length;a<o;a++){_init.beforeA[a].apply(this,arguments)}},getInnerAfterA:function(e,t,n){for(var a=0,o=_init.innerAfterA.length;a<o;a++){_init.innerAfterA[a].apply(this,arguments)}},getInnerBeforeA:function(e,t,n){for(var a=0,o=_init.innerBeforeA.length;a<o;a++){_init.innerBeforeA[a].apply(this,arguments)}},getCache:function(e){return caches[e.treeId]},getNextNode:function(e,t){if(!t)return null;var n=e.data.key.children,a=t.parentTId?t.getParentNode():data.getRoot(e);for(var o=0,i=a[n].length-1;o<=i;o++){if(a[n][o]===t){return o==i?null:a[n][o+1]}}return null},getNodeByParam:function(e,t,n,a){if(!t||!n)return null;var o=e.data.key.children;for(var i=0,r=t.length;i<r;i++){if(t[i][n]==a){return t[i]}var s=data.getNodeByParam(e,t[i][o],n,a);if(s)return s}return null},getNodeCache:function(e,t){if(!t)return null;var n=caches[e.treeId].nodes[data.getNodeCacheId(t)];return n?n:null},getNodeName:function(e,t){var n=e.data.key.name;return""+t[n]},getNodeTitle:function(e,t){var n=e.data.key.title===""?e.data.key.name:e.data.key.title;return""+t[n]},getNodes:function(e){return data.getRoot(e)[e.data.key.children]},getNodesByParam:function(e,t,n,a){if(!t||!n)return[];var o=e.data.key.children,i=[];for(var r=0,s=t.length;r<s;r++){if(t[r][n]==a){i.push(t[r])}i=i.concat(data.getNodesByParam(e,t[r][o],n,a))}return i},getNodesByParamFuzzy:function(e,t,n,a){if(!t||!n)return[];var o=e.data.key.children,i=[];a=a.toLowerCase();for(var r=0,s=t.length;r<s;r++){if(typeof t[r][n]=="string"&&t[r][n].toLowerCase().indexOf(a)>-1){i.push(t[r])}i=i.concat(data.getNodesByParamFuzzy(e,t[r][o],n,a))}return i},getNodesByFilter:function(e,t,n,a,o){if(!t)return a?null:[];var i=e.data.key.children,r=a?null:[];for(var s=0,l=t.length;s<l;s++){if(tools.apply(n,[t[s],o],false)){if(a){return t[s]}r.push(t[s])}var d=data.getNodesByFilter(e,t[s][i],n,a,o);if(a&&!!d){return d}r=a?d:r.concat(d)}return r},getPreNode:function(e,t){if(!t)return null;var n=e.data.key.children,a=t.parentTId?t.getParentNode():data.getRoot(e);for(var o=0,i=a[n].length;o<i;o++){if(a[n][o]===t){return o==0?null:a[n][o-1]}}return null},getRoot:function(e){return e?roots[e.treeId]:null},getRoots:function(){return roots},getSetting:function(e){return settings[e]},getSettings:function(){return settings},getZTreeTools:function(e){var t=this.getRoot(this.getSetting(e));return t?t.treeTools:null},initCache:function(e){for(var t=0,n=_init.caches.length;t<n;t++){_init.caches[t].apply(this,arguments)}},initNode:function(e,t,n,a,o,i){for(var r=0,s=_init.nodes.length;r<s;r++){_init.nodes[r].apply(this,arguments)}},initRoot:function(e){for(var t=0,n=_init.roots.length;t<n;t++){_init.roots[t].apply(this,arguments)}},isSelectedNode:function(e,t){var n=data.getRoot(e);for(var a=0,o=n.curSelectedList.length;a<o;a++){if(t===n.curSelectedList[a])return true}return false},removeNodeCache:function(e,t){var n=e.data.key.children;if(t[n]){for(var a=0,o=t[n].length;a<o;a++){arguments.callee(e,t[n][a])}}data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){var n=data.getRoot(e);for(var a=0,o=n.curSelectedList.length;a<o;a++){if(t===n.curSelectedList[a]||!data.getNodeCache(e,n.curSelectedList[a].tId)){n.curSelectedList.splice(a,1);a--;o--}}},setCache:function(e,t){caches[e.treeId]=t},setRoot:function(e,t){roots[e.treeId]=t},setZTreeTools:function(e,t){for(var n=0,a=_init.zTreeTools.length;n<a;n++){_init.zTreeTools[n].apply(this,arguments)}},transformToArrayFormat:function(e,t){if(!t)return[];var n=e.data.key.children,a=[];if(tools.isArray(t)){for(var o=0,i=t.length;o<i;o++){a.push(t[o]);if(t[o][n])a=a.concat(data.transformToArrayFormat(e,t[o][n]))}}else{a.push(t);if(t[n])a=a.concat(data.transformToArrayFormat(e,t[n]))}return a},transformTozTreeFormat:function(e,t){var n,a,o=e.data.simpleData.idKey,i=e.data.simpleData.pIdKey,r=e.data.key.children;if(!o||o==""||!t)return[];if(tools.isArray(t)){var s=[];var l=[];for(n=0,a=t.length;n<a;n++){l[t[n][o]]=t[n]}for(n=0,a=t.length;n<a;n++){if(l[t[n][i]]&&t[n][o]!=t[n][i]){if(!l[t[n][i]][r])l[t[n][i]][r]=[];l[t[n][i]][r].push(t[n])}else{s.push(t[n])}}return s}else{return[t]}}},event={bindEvent:function(e){for(var t=0,n=_init.bind.length;t<n;t++){_init.bind[t].apply(this,arguments)}},unbindEvent:function(e){for(var t=0,n=_init.unbind.length;t<n;t++){_init.unbind[t].apply(this,arguments)}},bindTree:function(e){var t={treeId:e.treeId},n=e.treeObj;if(!e.view.txtSelectedEnable){n.bind("selectstart",function(e){var t;var n=e.originalEvent.srcElement.nodeName.toLowerCase();return n==="input"||n==="textarea"}).css({"-moz-user-select":"-moz-none"})}n.bind("click",t,event.proxy);n.bind("dblclick",t,event.proxy);n.bind("mouseover",t,event.proxy);n.bind("mouseout",t,event.proxy);n.bind("mousedown",t,event.proxy);n.bind("mouseup",t,event.proxy);n.bind("contextmenu",t,event.proxy)},unbindTree:function(e){var t=e.treeObj;t.unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var t=[];for(var n=0,a=_init.proxys.length;n<a;n++){var o=_init.proxys[n].apply(this,arguments);t.push(o);if(o.stop){break}}return t},proxy:function(e){var t=data.getSetting(e.data.treeId);if(!tools.uCanDo(t,e))return true;var n=event.doProxy(e),a=true,o=false;for(var i=0,r=n.length;i<r;i++){var s=n[i];if(s.nodeEventCallback){o=true;a=s.nodeEventCallback.apply(s,[e,s.node])&&a}if(s.treeEventCallback){o=true;a=s.treeEventCallback.apply(s,[e,s.node])&&a}}return a}},handler={onSwitchNode:function(e,t){var n=data.getSetting(e.data.treeId);if(t.open){if(tools.apply(n.callback.beforeCollapse,[n.treeId,t],true)==false)return true;data.getRoot(n).expandTriggerFlag=true;view.switchNode(n,t)}else{if(tools.apply(n.callback.beforeExpand,[n.treeId,t],true)==false)return true;data.getRoot(n).expandTriggerFlag=true;view.switchNode(n,t)}return true},onClickNode:function(e,t){var n=data.getSetting(e.data.treeId),a=n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&data.isSelectedNode(n,t)?0:n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&n.view.selectedMulti?2:1;if(tools.apply(n.callback.beforeClick,[n.treeId,t,a],true)==false)return true;if(a===0){view.cancelPreSelectedNode(n,t)}else{view.selectNode(n,t,a===2)}n.treeObj.trigger(consts.event.CLICK,[e,n.treeId,t,a]);return true},onZTreeMousedown:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeMouseDown,[n.treeId,t],true)){tools.apply(n.callback.onMouseDown,[e,n.treeId,t])}return true},onZTreeMouseup:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeMouseUp,[n.treeId,t],true)){tools.apply(n.callback.onMouseUp,[e,n.treeId,t])}return true},onZTreeDblclick:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeDblClick,[n.treeId,t],true)){tools.apply(n.callback.onDblClick,[e,n.treeId,t])}return true},onZTreeContextmenu:function(e,t){var n=data.getSetting(e.data.treeId);if(tools.apply(n.callback.beforeRightClick,[n.treeId,t],true)){tools.apply(n.callback.onRightClick,[e,n.treeId,t])}return typeof n.callback.onRightClick!="function"}},tools={apply:function(e,t,n){if(typeof e=="function"){return e.apply(zt,t?t:[])}return n},canAsync:function(e,t){var n=e.data.key.children;return e.async.enable&&t&&t.isParent&&!(t.zAsync||t[n]&&t[n].length>0)},clone:function(e){if(e===null)return null;var t=tools.isArray(e)?[]:{};for(var n in e){t[n]=e[n]instanceof Date?new Date(e[n].getTime()):typeof e[n]==="object"?arguments.callee(e[n]):e[n]}return t},eqs:function(e,t){return e.toLowerCase()===t.toLowerCase()},isArray:function(e){return Object.prototype.toString.apply(e)==="[object Array]"},$:function(e,t,n){if(!!t&&typeof t!="string"){n=t;t=""}if(typeof e=="string"){return $(e,n?n.treeObj.get(0).ownerDocument:null)}else{return $("#"+e.tId+t,n?n.treeObj:null)}},getMDom:function(e,t,n){if(!t)return null;while(t&&t.id!==e.treeId){for(var a=0,o=n.length;t.tagName&&a<o;a++){if(tools.eqs(t.tagName,n[a].tagName)&&t.getAttribute(n[a].attrName)!==null){return t}}t=t.parentNode}return null},getNodeMainDom:function(e){return $(e).parent("li").get(0)||$(e).parentsUntil("li").parent().get(0)},isChildOrSelf:function(e,t){return $(e).closest("#"+t).length>0},uCanDo:function(e,t){return true}},view={addNodes:function(e,t,n,a){if(e.data.keep.leaf&&t&&!t.isParent){return}if(!tools.isArray(n)){n=[n]}if(e.data.simpleData.enable){n=data.transformTozTreeFormat(e,n)}if(t){var o=$$(t,consts.id.SWITCH,e),i=$$(t,consts.id.ICON,e),r=$$(t,consts.id.UL,e);if(!t.open){view.replaceSwitchClass(t,o,consts.folder.CLOSE);view.replaceIcoClass(t,i,consts.folder.CLOSE);t.open=false;r.css({display:"none"})}data.addNodesData(e,t,n);view.createNodes(e,t.level+1,n,t);if(!a){view.expandCollapseParentNode(e,t,true)}}else{data.addNodesData(e,data.getRoot(e),n);view.createNodes(e,0,n,null)}},appendNodes:function(e,t,n,a,o,i){if(!n)return[];var r=[],s=e.data.key.children;for(var l=0,d=n.length;l<d;l++){var c=n[l];if(o){var u=a?a:data.getRoot(e),f=u[s],p=f.length==n.length&&l==0,v=l==n.length-1;data.initNode(e,t,c,a,p,v,i);data.addNodeCache(e,c)}var N=[];if(c[s]&&c[s].length>0){N=view.appendNodes(e,t+1,c[s],c,o,i&&c.open)}if(i){view.makeDOMNodeMainBefore(r,e,c);view.makeDOMNodeLine(r,e,c);data.getBeforeA(e,c,r);view.makeDOMNodeNameBefore(r,e,c);data.getInnerBeforeA(e,c,r);view.makeDOMNodeIcon(r,e,c);data.getInnerAfterA(e,c,r);view.makeDOMNodeNameAfter(r,e,c);data.getAfterA(e,c,r);if(c.isParent&&c.open){view.makeUlHtml(e,c,r,N.join(""))}view.makeDOMNodeMainAfter(r,e,c);data.addCreatedNode(e,c)}}return r},appendParentULDom:function(e,t){var n=[],a=$$(t,e);if(!a.get(0)&&!!t.parentTId){view.appendParentULDom(e,t.getParentNode());a=$$(t,e)}var o=$$(t,consts.id.UL,e);if(o.get(0)){o.remove()}var i=e.data.key.children,r=view.appendNodes(e,t.level+1,t[i],t,false,true);view.makeUlHtml(e,t,n,r.join(""));a.append(n.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else if(node&&node.isAjaxing){return false}else if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"",class:consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1]}}else{for(var p in setting.async.otherParam){tmpParam[p]=setting.async.otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,cache:false,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}catch(e){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(e,t,n){if(_tmpV!=data.getRoot(setting)._ver){return}if(node)node.isAjaxing=null;view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,e,t,n])}});return true},cancelPreSelectedNode:function(e,t){var n=data.getRoot(e).curSelectedList;for(var a=0,o=n.length-1;o>=a;o--){if(!t||t===n[o]){$$(n[o],consts.id.A,e).removeClass(consts.node.CURSELECTED);if(t){data.removeSelectedNode(e,t);break}}}if(!t)data.getRoot(e).curSelectedList=[]},createNodeCallback:function(e){if(!!e.callback.onNodeCreated||!!e.view.addDiyDom){var t=data.getRoot(e);while(t.createdNodes.length>0){var n=t.createdNodes.shift();tools.apply(e.view.addDiyDom,[e.treeId,n]);if(!!e.callback.onNodeCreated){e.treeObj.trigger(consts.event.NODECREATED,[e.treeId,n])}}}},createNodes:function(e,t,n,a){if(!n||n.length==0)return;var o=data.getRoot(e),i=e.data.key.children,r=!a||a.open||!!$$(a[i][0],e).get(0);o.createdNodes=[];var s=view.appendNodes(e,t,n,a,true,r);if(!a){e.treeObj.append(s.join(""))}else{var l=$$(a,consts.id.UL,e);if(l.get(0)){l.append(s.join(""))}}view.createNodeCallback(e)},destroy:function(e){if(!e)return;data.initCache(e);data.initRoot(e);event.unbindTree(e);event.unbindEvent(e);e.treeObj.empty();delete settings[e.treeId]},expandCollapseNode:function(e,t,n,a,o){var i=data.getRoot(e),r=e.data.key.children;if(!t){tools.apply(o,[]);return}if(i.expandTriggerFlag){var s=o;o=function(){if(s)s();if(t.open){e.treeObj.trigger(consts.event.EXPAND,[e.treeId,t])}else{e.treeObj.trigger(consts.event.COLLAPSE,[e.treeId,t])}};i.expandTriggerFlag=false}if(!t.open&&t.isParent&&(!$$(t,consts.id.UL,e).get(0)||t[r]&&t[r].length>0&&!$$(t[r][0],e).get(0))){view.appendParentULDom(e,t);view.createNodeCallback(e)}if(t.open==n){tools.apply(o,[]);return}var l=$$(t,consts.id.UL,e),d=$$(t,consts.id.SWITCH,e),c=$$(t,consts.id.ICON,e);if(t.isParent){t.open=!t.open;if(t.iconOpen&&t.iconClose){c.attr("style",view.makeNodeIcoStyle(e,t))}if(t.open){view.replaceSwitchClass(t,d,consts.folder.OPEN);view.replaceIcoClass(t,c,consts.folder.OPEN);if(a==false||e.view.expandSpeed==""){l.show();tools.apply(o,[])}else{if(t[r]&&t[r].length>0){l.slideDown(e.view.expandSpeed,o)}else{l.show();tools.apply(o,[])}}}else{view.replaceSwitchClass(t,d,consts.folder.CLOSE);view.replaceIcoClass(t,c,consts.folder.CLOSE);if(a==false||e.view.expandSpeed==""||!(t[r]&&t[r].length>0)){l.hide();tools.apply(o,[])}else{l.slideUp(e.view.expandSpeed,o)}}}else{tools.apply(o,[])}},expandCollapseParentNode:function(e,t,n,a,o){if(!t)return;if(!t.parentTId){view.expandCollapseNode(e,t,n,a,o);return}else{view.expandCollapseNode(e,t,n,a)}if(t.parentTId){view.expandCollapseParentNode(e,t.getParentNode(),n,a,o)}},expandCollapseSonNode:function(e,t,n,a,o){var i=data.getRoot(e),r=e.data.key.children,s=t?t[r]:i[r],l=t?false:a,d=data.getRoot(e).expandTriggerFlag;data.getRoot(e).expandTriggerFlag=false;if(s){for(var c=0,u=s.length;c<u;c++){if(s[c])view.expandCollapseSonNode(e,s[c],n,l)}}data.getRoot(e).expandTriggerFlag=d;view.expandCollapseNode(e,t,n,a,o)},makeDOMNodeIcon:function(e,t,n){var a=data.getNodeName(t,n),o=t.view.nameIsHTML?a:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(t.view.enableMultiIcon){var i="";if(n.pId){if(n.streamNum>=1){if(n.streamStatus==0||n.streamStatus==2){i="button ico_ch_stream_main_open"}else{i="button ico_ch_stream_main_closed"}e.push("<span id='",n.tId,consts.id.ICON,0,"' title='' treeNode",consts.id.ICON," class='",i,"' style='",view.makeNodeIcoStyle(t,n),"'></span>")}}else{if(n.isOnline==0){i="button ico_is_offline"}else{i="button ico_device_main"}e.push("<span id='",n.tId,consts.id.ICON,0,"' title='' treeNode",consts.id.ICON," class='",i,"' style='",view.makeNodeIcoStyle(t,n),"'></span>")}i="";if(n.streamNum>=2){if(n.pId){if(n.streamStatus==1){i="button ico_ch_stream_sub_open"}else{i="button ico_ch_stream_sub_closed"}e.push("<span id='",n.tId,consts.id.ICON,1,"' title='' treeNode",consts.id.ICON," class='",i,"' style='",view.makeNodeIcoStyle(t,n),"'></span>")}}if(n.streamNum>=3){if(n.pId){if(n.streamStatus==3){i="button ico_ch_stream_third_open"}else{i="button ico_ch_stream_third_closed"}e.push("<span id='",n.tId,consts.id.ICON,2,"' title='' treeNode",consts.id.ICON," class='",i,"' style='",view.makeNodeIcoStyle(t,n),"'></span>")}}e.push("<span id='",n.tId,consts.id.SPAN,"'>",o,"</span>");if(n.pId&&n.recordStatus!=-1){e.push("<span id='",n.tId,consts.id.ICON,3,"' title='' treeNode",consts.id.ICON," class='",n.recordStatus?"button ico_ch_record_open":"button ico_ch_record_closed","' style='",view.makeNodeIcoStyle(t,n),"'></span>")}else{}}else{e.push("<span id='",n.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(t,n),"' style='",view.makeNodeIcoStyle(t,n),"'></span><span id='",n.tId,consts.id.SPAN,"'>",o,"</span>")}},makeDOMNodeLine:function(e,t,n){e.push("<span id='",n.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(t,n),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(e,t,n){e.push("</li>")},makeDOMNodeMainBefore:function(e,t,n){e.push("<li id='",n.tId,"' class='",consts.className.LEVEL,n.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e,t,n){e.push("</a>")},makeDOMNodeNameBefore:function(e,t,n){var a=data.getNodeTitle(t,n),o=view.makeNodeUrl(t,n),i=view.makeNodeFontCss(t,n),r=[];for(var s in i){r.push(s,":",i[s],";")}var l="";if(o!=null&&o.length>0){l="href='"+o+"'"}var d="";for(var c=0,u=r.length;c<u;c++){if(typeof r[c]=="object"){var f=r[c].length;if(f>0){for(var p=0;p<f;p++){d+=r[c][p]}}}else{d+=r[c]}}var v=view.makeNodeTarget(n);var N="<a id='"+n.tId+consts.id.A+"' class='"+consts.className.LEVEL+n.level+"' treeNode"+consts.id.A+' onclick="'+(n.click||"")+'" '+l+" target='"+v+"' style='"+d+"'";e.push(N);if(tools.apply(t.view.showTitle,[t.treeId,n],t.view.showTitle)&&a){e.push("title='",a.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}e.push(">")},makeNodeFontCss:function(e,t){var n=tools.apply(e.view.fontCss,[e.treeId,t],e.view.fontCss);return n&&typeof n!="function"?n:{}},makeNodeIcoClass:function(e,t){var n=["ico"];if(!t.isAjaxing){n[0]=(t.iconSkin?t.iconSkin+"_":"")+n[0];if(t.isParent){n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE)}else{n.push(consts.folder.DOCU)}}return consts.className.BUTTON+" "+n.join("_")},makeNodeIcoStyle:function(e,t){var n=[];if(!t.isAjaxing){var a=t.isParent&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t.icon;if(a)n.push("background:url(",a,") 0 0 no-repeat;");if(e.view.showIcon==false||!tools.apply(e.view.showIcon,[e.treeId,t],true)){n.push("width:0px;height:0px;")}}return n.join("")},makeNodeLineClass:function(e,t){var n=[];if(e.view.showLine){if(t.level==0&&t.isFirstNode&&t.isLastNode){n.push(consts.line.ROOT)}else if(t.level==0&&t.isFirstNode){n.push(consts.line.ROOTS)}else if(t.isLastNode){n.push(consts.line.BOTTOM)}else{n.push(consts.line.CENTER)}}else{n.push(consts.line.NOLINE)}if(t.isParent){n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE)}else{n.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(t)+n.join("_")},makeNodeLineClassEx:function(e){return consts.className.BUTTON+" "+consts.className.LEVEL+e.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var n=e.data.key.url;return t[n]?t[n]:null},makeUlHtml:function(e,t,n,a){n.push("<ul id='",t.tId,consts.id.UL,"' class='",consts.className.LEVEL,t.level," ",view.makeUlLineClass(e,t),"' style='display:",t.open?"block":"none","'>");n.push(a);n.push("</ul>")},makeUlLineClass:function(e,t){return e.view.showLine&&!t.isLastNode?consts.line.LINE:""},removeChildNodes:function(e,t){if(!t)return;var n=e.data.key.children,a=t[n];if(!a)return;for(var o=0,i=a.length;o<i;o++){data.removeNodeCache(e,a[o])}data.removeSelectedNode(e);delete t[n];if(!e.data.keep.parent){t.isParent=false;t.open=false;var r=$$(t,consts.id.SWITCH,e),s=$$(t,consts.id.ICON,e);view.replaceSwitchClass(t,r,consts.folder.DOCU);view.replaceIcoClass(t,s,consts.folder.DOCU);$$(t,consts.id.UL,e).remove()}else{$$(t,consts.id.UL,e).empty()}},setFirstNode:function(e,t){var n=e.data.key.children,a=t[n].length;if(a>0){t[n][0].isFirstNode=true}},setLastNode:function(e,t){var n=e.data.key.children,a=t[n].length;if(a>0){t[n][a-1].isLastNode=true}},removeNode:function(e,t){var n=data.getRoot(e),a=e.data.key.children,o=t.parentTId?t.getParentNode():n;t.isFirstNode=false;t.isLastNode=false;t.getPreNode=function(){return null};t.getNextNode=function(){return null};if(!data.getNodeCache(e,t.tId)){return}$$(t,e).remove();data.removeNodeCache(e,t);data.removeSelectedNode(e,t);for(var i=0,r=o[a].length;i<r;i++){if(o[a][i].tId==t.tId){o[a].splice(i,1);break}}view.setFirstNode(e,o);view.setLastNode(e,o);var s,l,d,c=o[a].length;if(!e.data.keep.parent&&c==0){o.isParent=false;o.open=false;s=$$(o,consts.id.UL,e);l=$$(o,consts.id.SWITCH,e);d=$$(o,consts.id.ICON,e);view.replaceSwitchClass(o,l,consts.folder.DOCU);view.replaceIcoClass(o,d,consts.folder.DOCU);s.css("display","none")}else if(e.view.showLine&&c>0){var u=o[a][c-1];s=$$(u,consts.id.UL,e);l=$$(u,consts.id.SWITCH,e);d=$$(u,consts.id.ICON,e);if(o==n){if(o[a].length==1){view.replaceSwitchClass(u,l,consts.line.ROOT)}else{var f=$$(o[a][0],consts.id.SWITCH,e);view.replaceSwitchClass(o[a][0],f,consts.line.ROOTS);view.replaceSwitchClass(u,l,consts.line.BOTTOM)}}else{view.replaceSwitchClass(u,l,consts.line.BOTTOM)}s.removeClass(consts.line.LINE)}},replaceIcoClass:function(e,t,n){if(1||!t||e.isAjaxing)return;var a=t.attr("class");if(a==undefined)return;var o=a.split("_");switch(n){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:o[o.length-1]=n;break}t.attr("class",o.join("_"))},replaceSwitchClass:function(e,t,n){if(!t)return;var a=t.attr("class");if(a==undefined)return;var o=a.split("_");switch(n){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:o[0]=view.makeNodeLineClassEx(e)+n;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:o[1]=n;break}t.attr("class",o.join("_"));if(n!==consts.folder.DOCU){t.removeAttr("disabled")}else{t.attr("disabled","disabled")}},selectNode:function(e,t,n){if(!n){view.cancelPreSelectedNode(e)}$$(t,consts.id.A,e).addClass(consts.node.CURSELECTED);data.addSelectedNode(e,t)},setNodeFontCss:function(e,t){var n=$$(t,consts.id.A,e),a=view.makeNodeFontCss(e,t);if(a){n.css(a)}},setNodeLineIcos:function(e,t){if(!t)return;var n=$$(t,consts.id.SWITCH,e),a=$$(t,consts.id.UL,e),o=$$(t,consts.id.ICON+0,e),i=$$(t,consts.id.ICON+1,e),r=$$(t,consts.id.ICON+2,e),s=$$(t,consts.id.ICON+3,e),l=view.makeUlLineClass(e,t);if(l.length==0){a.removeClass(consts.line.LINE)}else{a.addClass(l)}n.attr("class",view.makeNodeLineClass(e,t));if(t.isParent){n.removeAttr("disabled")}else{n.attr("disabled","disabled")}if(t.pId){var d="";if(t.streamStatus==0||t.streamStatus==2){d="button ico_ch_stream_main_open"}else{d="button ico_ch_stream_main_closed"}$(o).attr("class",d);d="";if(t.streamStatus==1){d="button ico_ch_stream_sub_open"}else{d="button ico_ch_stream_sub_closed"}$(i).attr("class",d);d="";if(t.streamStatus==3){d="button ico_ch_stream_third_open"}else{d="button ico_ch_stream_third_closed"}$(r).attr("class",d);$(s).attr("class",t.recordStatus?"button ico_ch_record_open":"button ico_ch_record_closed")}else{$(o).attr("class",t.isOnline?"button ico_device_main":"button ico_is_offline");$(s).attr("class",t.voicetalkStatus?"button ico_device_voicetalk_open":"button ico_device_voicetalk_closed")}},setNodeName:function(e,t){var n=data.getNodeTitle(e,t),a=$$(t,consts.id.SPAN,e);a.empty();a.html(data.getNodeName(e,t));if(tools.apply(e.view.showTitle,[e.treeId,t],e.view.showTitle)){var o=$$(t,consts.id.A,e);o.attr("title",!n?"":n)}},setNodeTarget:function(e,t){var n=$$(t,consts.id.A,e);n.attr("target",view.makeNodeTarget(t))},setNodeUrl:function(e,t){var n=$$(t,consts.id.A,e),a=view.makeNodeUrl(e,t);if(a==null||a.length==0){n.removeAttr("href")}else{n.attr("href",a)}},switchNode:function(e,t){if(t.open||!tools.canAsync(e,t)){view.expandCollapseNode(e,t,!t.open)}else if(e.async.enable){if(!view.asyncNode(e,t)){view.expandCollapseNode(e,t,!t.open);return}}else if(t){view.expandCollapseNode(e,t,!t.open)}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(e){var t=data.getZTreeTools(e);return t?t:null},destroy:function(e){if(!!e&&e.length>0){view.destroy(data.getSetting(e))}else{for(var t in settings){view.destroy(settings[t])}}},init:function(e,t,n){var l=tools.clone(_setting);$.extend(true,l,t);l.treeId=e.attr("id");l.treeObj=e;l.treeObj.empty();settings[l.treeId]=l;if(typeof document.body.style.maxHeight==="undefined"){l.view.expandSpeed=""}data.initRoot(l);var a=data.getRoot(l),o=l.data.key.children;n=n?tools.clone(tools.isArray(n)?n:[n]):[];if(l.data.simpleData.enable){a[o]=data.transformTozTreeFormat(l,n)}else{a[o]=n}data.initCache(l);event.unbindTree(l);event.bindTree(l);event.unbindEvent(l);event.bindEvent(l);var i={setting:l,addNodes:function(e,t,n){if(!t)return null;if(!e)e=null;if(e&&!e.isParent&&l.data.keep.leaf)return null;var a=tools.clone(tools.isArray(t)?t:[t]);function o(){view.addNodes(l,e,a,n==true)}if(tools.canAsync(l,e)){view.asyncNode(l,e,n,o)}else{o()}return a},cancelSelectedNode:function(e){view.cancelPreSelectedNode(l,e)},destroy:function(){view.destroy(l)},expandAll:function(e){e=!!e;view.expandCollapseSonNode(l,null,e,true);return e},expandNode:function(e,t,n,a,o){if(!e||!e.isParent)return null;if(t!==true&&t!==false){t=!e.open}o=!!o;if(o&&t&&tools.apply(l.callback.beforeExpand,[l.treeId,e],true)==false){return null}else if(o&&!t&&tools.apply(l.callback.beforeCollapse,[l.treeId,e],true)==false){return null}if(t&&e.parentTId){view.expandCollapseParentNode(l,e.getParentNode(),t,false)}if(t===e.open&&!n){return null}data.getRoot(l).expandTriggerFlag=o;if(!tools.canAsync(l,e)&&n){view.expandCollapseSonNode(l,e,t,true,function(){if(a!==false){try{$$(e,l).focus().blur()}catch(e){}}})}else{e.open=!t;view.switchNode(l,e);if(a!==false){try{$$(e,l).focus().blur()}catch(e){}}}return t},getNodes:function(){return data.getNodes(l)},getNodeByParam:function(e,t,n){if(!e)return null;return data.getNodeByParam(l,n?n[l.data.key.children]:data.getNodes(l),e,t)},getNodeByTId:function(e){return data.getNodeCache(l,e)},getNodesByParam:function(e,t,n){if(!e)return null;return data.getNodesByParam(l,n?n[l.data.key.children]:data.getNodes(l),e,t)},getNodesByParamFuzzy:function(e,t,n){if(!e)return null;return data.getNodesByParamFuzzy(l,n?n[l.data.key.children]:data.getNodes(l),e,t)},getNodesByFilter:function(e,t,n,a){t=!!t;if(!e||typeof e!="function")return t?null:[];return data.getNodesByFilter(l,n?n[l.data.key.children]:data.getNodes(l),e,t,a)},getNodeIndex:function(e){if(!e)return null;var t=l.data.key.children,n=e.parentTId?e.getParentNode():data.getRoot(l);for(var a=0,o=n[t].length;a<o;a++){if(n[t][a]==e)return a}return-1},getSelectedNodes:function(){var e=[],t=data.getRoot(l).curSelectedList;for(var n=0,a=t.length;n<a;n++){e.push(t[n])}return e},isSelectedNode:function(e){return data.isSelectedNode(l,e)},reAsyncChildNodes:function(e,t,n){if(!this.setting.async.enable)return;var a=!e;if(a){e=data.getRoot(l)}if(t=="refresh"){var o=this.setting.data.key.children;for(var i=0,r=e[o]?e[o].length:0;i<r;i++){data.removeNodeCache(l,e[o][i])}data.removeSelectedNode(l);e[o]=[];if(a){this.setting.treeObj.empty()}else{var s=$$(e,consts.id.UL,l);s.empty()}}view.asyncNode(this.setting,a?null:e,!!n)},refresh:function(){this.setting.treeObj.empty();var e=data.getRoot(l),t=e[l.data.key.children];data.initRoot(l);e[l.data.key.children]=t;data.initCache(l);view.createNodes(l,0,e[l.data.key.children])},removeChildNodes:function(e){if(!e)return null;var t=l.data.key.children,n=e[t];view.removeChildNodes(l,e);return n?n:null},removeNode:function(e,t){if(!e)return;t=!!t;if(t&&tools.apply(l.callback.beforeRemove,[l.treeId,e],true)==false)return;view.removeNode(l,e);if(t){this.setting.treeObj.trigger(consts.event.REMOVE,[l.treeId,e])}},selectNode:function(e,t){if(!e)return;if(tools.uCanDo(l)){t=l.view.selectedMulti&&t;if(e.parentTId){view.expandCollapseParentNode(l,e.getParentNode(),true,false,function(){try{$$(e,l).focus().blur()}catch(e){}})}else{try{$$(e,l).focus().blur()}catch(e){}}view.selectNode(l,e,t)}},transformTozTreeNodes:function(e){return data.transformTozTreeFormat(l,e)},transformToArray:function(e){return data.transformToArrayFormat(l,e)},updateNode:function(e,t){if(!e)return;var n=$$(e,l);if(n.get(0)&&tools.uCanDo(l)){view.setNodeName(l,e);view.setNodeTarget(l,e);view.setNodeUrl(l,e);view.setNodeLineIcos(l,e);view.setNodeFontCss(l,e)}}};a.treeTools=i;data.setZTreeTools(l,i);if(a[o]&&a[o].length>0){view.createNodes(l,0,a[o])}else if(l.async.enable&&l.async.url&&l.async.url!==""){view.asyncNode(l)}return i}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);